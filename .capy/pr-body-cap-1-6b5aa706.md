Summary
- Why: Enable real, commitment-based dating events that match by interests/eligibility and gather feedback after dates. Improves user intent, reduces no‑shows, and builds trust through deposits and transparent refunds.
- What: Introduce date_ideen_* event schema, PostGIS-backed radius search and eligibility, Stripe deposit flow, post-date survey notifications, and minimal web UI to create, discover, join, and rate events.

Key changes
- Database (migrations)
  - Create tables with required prefix date_ideen_*: events, event_participants, event_invitations, payments, feedback, notifications.
  - Add enums: date_ideen_gender_policy, date_ideen_participant_status, date_ideen_payment_status, date_ideen_refund_status.
  - PostGIS indices and date_ideen_search_events_by_radius function (uses ST_DWithin/ST_Distance).
  - Eligibility function date_ideen_is_user_eligible (age 21–45 default, balanced gender policy, interest overlap, in-radius check) enforced by trigger on event_participants insert.
  - RLS policies for events/participants/invitations/payments/feedback/notifications (organizer/participant scoped).
- Edge Functions (Supabase)
  - payments: Create Stripe Payment Intent for event deposit and persist date_ideen_payments row.
  - stripe_webhook: Update payment statuses on succeeded/failed/canceled/refunded.
  - post_date_survey: 2h after event end, send in-app notifications (and email via Resend if configured) asking for feedback; writes date_ideen_notifications and marks survey_sent_at.
  - refunds: Issue automatic refunds via Stripe per policy (full if both mark “not good”, else 50% minus 10% platform fee), update payments/participants statuses.
  - config.toml updated to register functions and JWT verification where needed.
- Web app (minimal flows)
  - New routes/pages: /events (list), /events/create, /events/:id (detail + deposit checkout), /events/:id/survey (post-date feedback), /notifications (in-app inbox).
  - Stripe client integration (DepositCheckout) and RPC usage for radius search.
  - App routing extended; package.json adds @stripe/react-stripe-js and @stripe/stripe-js.
  - Supabase types updated to include new tables/enums/functions.

Refund/fee policy (initial defaults)
- Deposit: 10 EUR (configurable per event).
- Platform/processing fee retained on refund: 10%.
- Refund: Full if both participants mark “not good”; otherwise 50%.

Operational notes
- No GitHub Actions. All automation runs via Supabase functions/cron and DB logic, per request.
- Geocoding remains via existing geocode Edge Function; distance/eligibility via PostGIS.
- Organizer must be email-verified to create events.

Environment variables (configure in Supabase, not via CI)
- STRIPE_SECRET_KEY (required for payments/refunds Edge Functions)
- VITE_STRIPE_PUBLISHABLE_KEY (web client)
- RESEND_API_KEY (optional; post_date_survey email)
- APP_BASE_URL (for survey link in emails)

Impact
- Backward compatible with existing ideas features; adds new event/notification capabilities.
- Requires deploying new Edge Functions and running the migration in Supabase.

Testing
- Manual happy-path tested locally: create event → join with deposit → stripe_webhook updates status → survey notification created → submitting feedback → refunds function logic applies.

Follow-ups (separate PRs recommended)
- UI polish for invitations/group capacity, admin dashboards for disputes, and Realtime chat per event.
- Additional eligibility options and per-event refund policies.


₍ᐢ•(ܫ)•ᐢ₎ Generated by [Capy](https://capy.ai) ([view task](https://capy.ai/project/9da08578-2e83-4406-885b-9b3c2e40acfd/task/6b5aa706-9d83-47a1-91dc-3c11375bd520))